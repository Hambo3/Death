var Fac = [];
var ISO = 0.95;
var C = {
    pal:{
        white:13+48,
        black:14,
        title:40,
        gameover:15,
        pickup:15+16,
        sign:11+16,
        signtxt:11 
    },
    col:{
        man:20,
        hat:21,    
        shadow:22,
        tree:23,
        rock:24,
        wall:25,
        sign:26,
        items:27,
        splash:28,
        pc:29,
        table:30
    },   
    ass:{
        null:0,
        hard:1,
        wall:2,
        sign:3,
        player:5,
        pickup1:8,
        pickup2:9,
        ptext:10
    },
    act:{
        up:0,
        dn:1,
        lt:2,
        rt:3,
        splat:4,
        splash:5,
        fall:6,
        dead:7
    },
    sound:{
        hop1:0,
        hop2:1,
        fall:3,
        splash:4,
        collect1:5,
        wibble:6
    }
}

var MODE = {
    title:0,
    start:1,
    ready:2,
    game:3,    
    level:4,
    deathInfo:5,
    postInfo:6,
    over:9
}

var COLS = [
    [9+48],[9+32], 
    [13+16],[13+32], 
    [0+32],[0+32,0+16], 
    [11+32],[11+32,11+16], 
    [2+32],[2+48], 
    [13+48, 13+32], [6+48, 6+32],
    [11],[11+48],
    [9+32],[9+48],[13+16],
    [],[],[],//spare
    [//20
        1+48,1+32,1+16,1,
        12+48,12+32,11+32,11+16,
        13+48,13+32
    ],
    [//21 hat
        14+48,14+32,14+16,14
    ],
    [15+48],//22 shadow
    [//23tree
        9+48,9+32,9+16,9, 11,11+16
    ],
    [
        //24 rock??
        5
    ],
    [ //25wall
        6+48,6+32,6+16,6, 14,13+32
    ],
    [//26
        8+48,8+32,8+16,8, 14,13+32
    ],
    [//27
        8+48,8+32,8+16,8, 14,13+32
    ],
    [//28 splash
        1+48,1+32,1+16
    ],
    [//29
        13,13+16,13+32,14+16,13+48
    ]
    ,
    [//30
        11,11+16,11+32
    ]
];
//           0      1       2     3    4       5       6      7      8      9     10     11     12     13     14     15
//           blu1  blu2   purp         pink    red    orng   yell          gr2    tq?    brn    flesh  whit   blck   spec
var PAL =[  "#134","#124","#214","#414","#413","#412","#421","#441","#341","#5a3","#144","#632","#953","#666","#000","#505",
            "#38a","#34a","#53a","#93a","#a38","#a34","#a53","#a93","#8a3","#5b3","#3a9","#742","#c74","#999","#222","#ff3",
            "#6be","#67e","#96e","#d6e","#e6b","#e67","#e96","#ed6","#be6","#5c3","#6ed","#851","#f95","#ccc","#333","#000",
            "#cef","#ccf","#dcf","#fcf","#fce","#fcc","#fdc","#ffc","#dfc","#5d3","#cff","#a61","#fb8","#fff","#555","#555"
];
   
var ST = [
"YOU ARE WORKING LATE AGAIN.|YOU START TO FEEL SLEEPY AND YOU FALL|ASLEEP AT YOUR DESK PLAYING MINESWEEPER.",
"YOU AWAKEN IN A STRANGE PLACE."
];

var OV=[
    "THERE WAS NO WAY OF KNOWING THAT|THE GROUND BENEATH YOU WAS SO|UNSTABLE AND YOU FELL TO YOUR",
    "DEATH"
];

var HLP = [
"K TO THROW STONE",
"HOLD L AND MOVE|TO DROP BREADCRUMB",
"YOUR MAGIC HAT SENSES DANGER!|THERE ARE {0} ADJACENT STEPS|THAT COULD LEAD TO DEATH|"];

var signs = [
    0,
    "YOU ARE IN A ROOM|THERE IS FOOD HERE",
    "YOU ARE IN A ROOM|YOU SEE A ROCK ON THE FLOOR",
    "YOU HAVE DIED OF DYSENTERY",
    "ALL YOUR BASES ARE BELONG TO US",
    "GO NORTH",
    "GO WEST",
    "BEWARE TROLLS"
];
//You have died of dysentery.
var assets ={   
    hero:{
        bodyH:[2,[8,11,0,-8,11,0,-8,11,-16,8,11,-16],3,[8,-4,0,8,11,0,8,11,-16,8,-4,-16],1,[16,16,-8,-16,16,-8,-16,16,-24,16,16,-24],3,[16,-16,-8,16,16,-8,16,16,-24,16,-16,-24],8,[16,16,-14,-16,16,-14,-16,16,-24,16,16,-24],9,[16,-16,-13,16,16,-14,16,16,-24,16,-16,-24],4,[16,16,-24,-16,16,-24,-16,16,-40,16,16,-40],5,[16,-16,-24,16,16,-24,16,16,-40,16,-16,-40],6,[-16,-16,-40,16,-16,-40,16,16,-40,-16,16,-40],9,[5,22,-6,-2,22,-6,-2,22,-21,5,22,-21],9,[5,16,-6,5,22,-6,5,22,-21,5,16,-21],8,[-2,16,-21,5,16,-21,5,22,-21,-2,22,-21]],
        bodyV:[
            2,[8,11,0,-8,11,0,-8,11,-16,8,11,-16],
            3,[8,-4,0,8,11,0,8,11,-16,8,-4,-16],
            9,[-16,4,-6,-21,4,-6,-21,4,-21,-16,4,-21],
            9,[-20,-4,-6,-20,4,-6,-20,4,-21,-20,-4,-21],
            8,[-21,-4,-21,-16,-4,-21,-16,4,-21,-21,4,-21],
            1,[16,16,-8,-16,16,-8,-16,16,-24,16,16,-24],
            3,[16,-16,-8,16,16,-8,16,16,-24,16,-16,-24],
            8,[16,16,-14,-16,16,-14,-16,16,-24,16,16,-24],
            9,[16,-16,-13,16,16,-14,16,16,-24,16,-16,-24],
            4,[16,16,-24,-16,16,-24,-16,16,-40,16,16,-40],
            5,[16,-16,-24,16,16,-24,16,16,-40,16,-16,-40],
            6,[-16,-16,-40,16,-16,-40,16,16,-40,-16,16,-40],
            9,[21,4,-6,16,4,-6,16,4,-21,21,4,-21],
            9,[21,-4,-6,21,4,-6,21,4,-21,21,-4,-21],
            8,[16,-4,-21,21,-4,-21,21,4,-21,16,4,-21]
            ],
        up:[6,[16,16,-27,-16,16,-27,-16,16,-40,16,16,-40],7,[16,-2,-27,16,16,-27,16,17,-40,16,-16,-40,16,-16,-34,16,-2,-33]
        ],
        down:[2,[-3,16,-33,-9,16,-33,-9,16,-36,-3,16,-36],2,[10,16,-33,4,16,-33,4,16,-36,10,16,-36],2,[15,16,-26,-15,16,-26,-15,16,-29,15,16,-29],7,[16,-2,-28,16,-16,-28,16,-16,-40,16,16,-40,16,16,-34,16,-1,-34]
        ],
        left:[7,[2,16,-28,16,16,-28,16,16,-40,-16,16,-40,-16,16,-34,2,16,-34],7,[16,-16,-28,16,16,-28,16,16,-40,16,-16,-40]
        ],
        right:[7,[-2,16,-28,-16,16,-28,-16,16,-40,16,16,-40,16,16,-34,-2,16,-34],7,[16,-16,-35,16,16,-35,16,16,-40,16,-16,-40],3,[16,-14,-26,16,14,-26,16,14,-28,16,-14,-28],3, [16,5,-31,16,11,-31,16,11,-33,16,5,-33],3,[16,-11,-31,16,-6,-31,16,-5,-33,16,-11,-33]
        ]
    },
    tree1:[4,[8,8,0,-8,8,0,-8,8,-32,8,8,-32],5,[8,-8,0,8,8,0,8,8,-32,8,-8,-32],2,[16,16,-32,-16,16,-32,-16,16,-66,16,16,-66],3,[16,-16,-32,16,16,-32,16,16,-66,16,-16,-66],0,[-16,-16,-66,16,-16,-66,16,16,-66,-16,16,-66]
    ],
    tree2:[4,[8,8,0,-8,8,0,-8,8,-32,8,8,-32],5,[8,-8,0,8,8,0,8,8,-32,8,-8,-32],2,[16,16,-27,-16,16,-27,-16,16,-38,16,16,-38],3,[16,-16,-28,16,16,-28,16,16,-38,16,-16,-38],0,[-16,-16,-38,16,-16,-38,16,16,-38,-16,16,-38],3,[8,-8,-38,8,8,-38,8,8,-50,8,-8,-50],2,[8,8,-38,-8,8,-38,-8,8,-50,8,8,-50],1,[-8,-8,-50,8,-8,-50,8,8,-50,-8,8,-50]
    ],    
    hat:[0,[-16,-16,0, 16,-16,0, 16,16,0, -16,16,0],
        1,[-10,-10,-16, 10,-10,-16, 10,10,-16, -10,10,-16],
        3,[10,-10,0, 10,10,0, 10,10,-16, 10,-10,-16],
        2,[10,10,0, -10,10,0, -10,10,-16, 10,10,-16]
    ],
    hair:[0,[-22,16,-27,-18,16,-27,-18,16,-45,20,16,-45,20,16,-27,24,16,-27,24,16,-23,14,16,-23,14,16,-38,7,16,-35,-13,16,-37,-13,16,-23,-22,16,-23],
    1,[20,-16,-27,20,16,-27,20,16,-45,20,-16,-45],
    1,[24,-16,-23,24,16,-23,24,16,-27,24,-16,-27],
    2,[-18,-16,-45,20,-16,-45,20,16,-45,-18,16,-45],
    2,[20,-16,-27,24,-16,-27,24,16,-27,20,16,-27]
    ],
    square:[0,[-16,-16,-16, 16,-16,-16, 16,16,-16, -16,16,-16],
            2,[16,-16,0, 16,16,0, 16,16,-16, 16,-16,-16],
            1,[16,16,0, -16,16,0, -16,16,-16, 16,16,-16]
    ],
    wall16:[1,[-16,-16,-16,16,-16,-16,16,16,-16,-16,16,-16],2,[16,16,0,-16,16,0,-16,16,-16,16,16,-16],3,[3,16,0,-16,16,0,-16,16,-6,3,16,-6],3,[16,16,-8,-3,16,-8,-3,16,-14,16,16,-14],3,[16,16,0,5,16,0,5,16,-6,16,16,-6],3,[-5,16,-8,-16,16,-8,-16,16,-14,-5,16,-14]],
    tile:[
        0,[-16,-16,0, 16,-16,0, 16,16,0, -16,16,0]
    ],
    tile1:[0,[-16,-16,0,16,-16,0,16,16,0,-16,16,0],1,[-15,-15,0,15,-15,0,15,15,0,-15,15,0]],
    tile2:[0,[-16,-16,0,16,-16,0,16,16,0,-16,16,0],1,[-11,16,0,-16,16,0,-16,-16,0]],
    table:[1,[31,16,0,27,16,0,27,16,-16,31,16,-16],0,[31,12,0,31,16,0,31,16,-16,31,12,-16],1,[-27,16,0,-31,16,0,-31,16,-16,-27,16,-16],0,[-27,12,0,-27,16,0,-27,16,-16,-27,12,-16],1,[31,-12,0,27,-12,0,27,-12,-16,31,-12,-16],0,[31,-16,0,31,-12,0,31,-12,-16,31,-16,-16],0,[-32,-16,-16,32,-16,-16,32,16,-16,-32,16,-16],2,[-32,-16,-17,32,-16,-17,32,16,-17,-32,16,-17]],
    pc:[1,[16,16,0,-16,16,0,-16,16,-8,16,16,-8],0,[16,-16,0,16,16,0,16,16,-8,16,-16,-8],2,[-16,-16,-8,16,-16,-8,16,16,-8,-16,16,-8],1,[16,14,-10,-16,14,-10,-16,14,-26,16,14,-26],0,[16,-18,-10,16,14,-10,16,14,-26,16,-18,-26],2,[-16,-18,-26,16,-18,-26,16,14,-26,-16,14,-26],3,[14,14,-12,-14,14,-12,-14,14,-24,14,14,-24],4,[10,14,-15,-5,14,-15,-5,14,-23,10,14,-23]],
    lives:[0,[-8,-8,8,-8,8,8,-8,8]
    ],
    levels:[
        [1,[-16,-10,16,-10,16,-2,13,-2,13,16,-13,16,-13,-2,-16,-2]],
        [1,[-16,-10,-6,-10,-6,16,-13,16,-13,-2,-16,-2]],
        [1,[-16,-10,6,-10,6,16,-13,16,-13,-2,-16,-2]]
    ]
};

var SOUNDS = [
    [,,434,.02,.02,.01,2,.23,-0.1,-0.1,-100,,.01,,14,.5,,.9,,.39],//hop1
    [,,876,,.01,.01,2,.13,48,.2,,,,,35,,,.9],//hop2.1
    [,,876,,.01,.01,,.13,48,.2,50,,,,35,,,.9],//hop2.2
    [1.07,,1665,.02,.09,.16,1,.47,-0.3,-6.6,119,.02,,,,.1,,.41,.05,.17],//fall        
    [1.07,,1664,.02,.1,.16,,.37,-0.3,-6.5,119,.02,,.1,2,.1,,.41,.05,.17],//splash
    [1.02,,1590,,.01,.11,1,1.4,,,-161,.04,,,,.1,,.93,.02,.2],//collect
    [1.78,,1341,.21,,.16,1,.34,19,22,-15,.27,.18,,9.5,,.1,.23,.22,.27]
];

var FONT = {    
    'A': [
        [, 1, 0],
        [1, , 1],
        [1, 1, 1],
        [1, , 1],
        [1, , 1]
    ],
    'B': [
        [1, 1, 0],
        [1, , 1],
        [1, 1, 1],
        [1, , 1],
        [1, 1,0]
    ],
    'C': [
        [1, 1, 1],
        [1,0,0],
        [1,0,0],
        [1,0,0],
        [1, 1, 1]
    ],
    'D': [
        [1, 1,0],
        [1, , 1],
        [1, , 1],
        [1, , 1],
        [1, 1,0]
    ],
    'E': [
        [1, 1, 1],
        [1,0,0],
        [1, 1, 1],
        [1,0,0],
        [1, 1, 1]
    ],
    'F': [
        [1, 1, 1],
        [1,0,0],
        [1, 1,1],
        [1,0,0],
        [1,0,0]
    ],
    'G': [
        [, 1, 1,0],
        [1,0,0,0],
        [1, , 1, 1],
        [1, , , 1],
        [, 1, 1,0]
    ],
    'H': [
        [1, , 1],
        [1, , 1],
        [1, 1, 1],
        [1, , 1],
        [1, , 1]
    ],
    'I': [
        [1, 1, 1],
        [, 1,0],
        [, 1,0],
        [, 1,0],
        [1, 1, 1]
    ],
    'J': [
        [1, 1, 1],
        [, , 1],
        [, , 1],
        [1, , 1],
        [1, 1, 1]
    ],
    'K': [
        [1, , , 1],
        [1, , 1,0],
        [1, 1,0,0],
        [1, , 1,0],
        [1, , , 1]
    ],
    'L': [
        [1,0,0],
        [1,0,0],
        [1,0,0],
        [1,0,0],
        [1, 1, 1]
    ],
    'M': [
        [1,1,1,1],
        [1,0,1,1],
        [1,0,1,1],
        [1,0,0,1],
        [1,0,0,1]
    ],
    'N': [
        [1, , , 1],
        [1, 1, , 1],
        [1, , 1, 1],
        [1, , , 1],
        [1, , , 1]
    ],
    'O': [
        [1, 1, 1],
        [1, , 1],
        [1, , 1],
        [1, , 1],
        [1, 1, 1]
    ],
    'P': [
        [1, 1, 1],
        [1, , 1],
        [1, 1, 1],
        [1,0,0],
        [1,0,0]
    ],
    'Q': [
        [0, 1, 1,0],
        [1, , , 1],
        [1, , , 1],
        [1, , 1, 1],
        [1, 1, 1, 1]
    ],
    'R': [
        [1, 1,0],
        [1, , 1],
        [1, , 1],
        [1, 1,0],
        [1, , 1]
    ],
    'S': [
        [1, 1, 1],
        [1,0,0],
        [1, 1, 1],
        [, , 1],
        [1, 1, 1]
    ],
    'T': [
        [1, 1, 1],
        [, 1,0],
        [, 1,0],
        [, 1,0],
        [, 1,0]
    ],
    'U': [
        [1, , 1],
        [1, , 1],
        [1, , 1],
        [1, , 1],
        [1, 1, 1]
    ],
    'V': [
        [1, , 1],
        [1, , 1],
        [1, , 1],
        [1, , 1],
        [0, 1, 0]
    ],
    'W': [
        [1, , , 1],
        [1, , , 1],
        [1, , , 1],
        [1, , 1, 1],
        [1, 1, 1,1]
    ],
    'X': [
        [1,0,1],
        [1,0,1],
        [0,1,0],
        [1,0,1],
        [1,0,1]
    ],
    'Y': [
        [1, , 1],
        [1, , 1],
        [, 1,0],
        [, 1,0],
        [, 1,0]
    ],
    'Z': [
        [1, 1, 1],
        [, , 1],
        [, 1,0],
        [1,0,0],
        [1, 1, 1]
    ],
    '0': [
        [1, 1, 1],
        [1, , 1],
        [1, , 1],
        [1, , 1],
        [1, 1, 1]
    ],
    '1': [
        [, 1,0],
        [, 1,0],
        [, 1,0],
        [, 1,0],
        [, 1,0]
    ],
    '2': [
        [1,1,1],
        [0,0,1],
        [1,1,1],
        [1,0,0],
        [1,1,1]
    ],
    '3':[
        [1,1,1],
        [0,0,1],
        [1,1,1],
        [0,0,1],
        [1,1,1]
    ],
    '4':[
        [1,0,1],
        [1,0,1],
        [1,1,1],
        [0,0,1],
        [0,0,1]
    ],
    '5':[
        [1,1,1],
        [1,0,0],
        [1,1,1],
        [0,0,1],
        [1,1,1]
    ],
    '6':[
        [1,1,1],
        [1,0,0],
        [1,1,1],
        [1,0,1],
        [1,1,1]
    ],
    '7':[
        [1,1,1],
        [0,0,1],
        [0,0,1],
        [0,0,1],
        [0,0,1]
    ],
    '8':[
        [1,1,1],
        [1,0,1],
        [1,1,1],
        [1,0,1],
        [1,1,1]
    ],
    '9':[
        [1,1,1],
        [1,0,1],
        [1,1,1],
        [0,0,1],
        [1,1,1]
    ],
    '[': [
        [,1,1],
        [,1,],
        [,1,],
        [,1,],
        [,1,1]
    ],
    ']': [
        [1,1,],
        [,1,],
        [,1,],
        [,1,],
        [1,1,]
    ],
    ' ': [
        [, ,],
        [, ,],
        [, ,],
        [, ,],
        [, ,]
    ],
    '?': [
        [1,1,1],
        [1,0,1],
        [0,1,1],
        [0,1,0],
        [0,1,0]
    ],
    '!': [
        [0,1,1],
        [0,1,1],
        [0,1,0],
        [0,0,0],
        [0,1,0]
    ],
    '.': [
        [, ,],
        [, ,],
        [, ,],
        [, ,],
        [,1,]
    ],
    '£':
    [
        [0,1,1],
        [0,1,],
        [1,1,1],
        [0,1,0],
        [1,1,1]
    ],
    '|':[]
};

